{"version":3,"file":"ProductTourSurveyStep.js","sourceRoot":"","sources":["../../../../../src/extensions/product-tours/components/ProductTourSurveyStep.tsx"],"names":[],"mappings":"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","sourcesContent":["import { h } from 'preact'\nimport { useState, useRef, useEffect } from 'preact/hooks'\nimport {\n    ProductTour,\n    ProductTourStep,\n    ProductTourDismissReason,\n    ProductTourSurveyQuestion,\n} from '../../../posthog-product-tours-types'\nimport { mergeAppearance } from '../product-tours-utils'\nimport { cancelSVG, IconPosthogLogo } from '../../surveys/icons'\nimport {\n    dissatisfiedEmoji,\n    neutralEmoji,\n    satisfiedEmoji,\n    veryDissatisfiedEmoji,\n    verySatisfiedEmoji,\n} from '../../surveys/icons'\n\nexport interface ProductTourSurveyStepProps {\n    tour: ProductTour\n    step: ProductTourStep\n    stepIndex: number\n    totalSteps: number\n    onSubmit: (response: string | number | null) => void\n    onPrevious: () => void\n    onDismiss: (reason: ProductTourDismissReason) => void\n}\n\nconst threeScaleEmojis = [dissatisfiedEmoji, neutralEmoji, satisfiedEmoji]\nconst fiveScaleEmojis = [veryDissatisfiedEmoji, dissatisfiedEmoji, neutralEmoji, satisfiedEmoji, verySatisfiedEmoji]\n\nfunction getScaleNumbers(scale: number): number[] {\n    switch (scale) {\n        case 5:\n            return [1, 2, 3, 4, 5]\n        case 10:\n            return [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n        default:\n            return [1, 2, 3, 4, 5]\n    }\n}\n\nfunction OpenTextInput({\n    value,\n    onChange,\n    onSubmit,\n}: {\n    value: string\n    onChange: (text: string) => void\n    onSubmit: () => void\n}): h.JSX.Element {\n    const inputRef = useRef<HTMLTextAreaElement>(null)\n\n    useEffect(() => {\n        setTimeout(() => inputRef.current?.focus(), 100)\n    }, [])\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n        if (e.key === 'Enter' && e.metaKey) {\n            e.preventDefault()\n            onSubmit()\n        }\n    }\n\n    return (\n        <textarea\n            ref={inputRef}\n            class=\"ph-tour-survey-textarea\"\n            rows={3}\n            placeholder=\"Your feedback (optional)...\"\n            value={value}\n            onInput={(e) => onChange((e.target as HTMLTextAreaElement).value)}\n            onKeyDown={handleKeyDown}\n        />\n    )\n}\n\nfunction RatingInput({\n    survey,\n    onSubmit,\n}: {\n    survey: ProductTourSurveyQuestion\n    onSubmit: (rating: number) => void\n}): h.JSX.Element {\n    const [selectedRating, setSelectedRating] = useState<number | null>(null)\n    const display = survey.display || 'emoji'\n    const scale = survey.scale || 5\n\n    const handleSelect = (rating: number) => {\n        setSelectedRating(rating)\n        // Auto-submit on selection for ratings\n        onSubmit(rating)\n    }\n\n    if (display === 'emoji') {\n        const emojis = scale === 3 ? threeScaleEmojis : fiveScaleEmojis\n        return (\n            <div class=\"ph-tour-survey-rating-container\">\n                <div class=\"ph-tour-survey-rating-emoji\">\n                    {emojis.map((emoji, idx) => {\n                        const rating = idx + 1\n                        const isActive = selectedRating === rating\n                        return (\n                            <button\n                                key={idx}\n                                type=\"button\"\n                                class={`ph-tour-survey-emoji-button ${isActive ? 'ph-tour-survey-emoji-button--active' : ''}`}\n                                onClick={() => handleSelect(rating)}\n                                aria-label={`Rate ${rating}`}\n                            >\n                                {emoji}\n                            </button>\n                        )\n                    })}\n                </div>\n                {(survey.lowerBoundLabel || survey.upperBoundLabel) && (\n                    <div class=\"ph-tour-survey-rating-labels\">\n                        <span>{survey.lowerBoundLabel}</span>\n                        <span>{survey.upperBoundLabel}</span>\n                    </div>\n                )}\n            </div>\n        )\n    }\n\n    // Number display\n    const numbers = getScaleNumbers(scale)\n    return (\n        <div class=\"ph-tour-survey-rating-container\">\n            <div\n                class=\"ph-tour-survey-rating-numbers\"\n                style={{ gridTemplateColumns: `repeat(${numbers.length}, minmax(0, 1fr))` }}\n            >\n                {numbers.map((num) => {\n                    const isActive = selectedRating === num\n                    return (\n                        <button\n                            key={num}\n                            type=\"button\"\n                            class={`ph-tour-survey-number-button ${isActive ? 'ph-tour-survey-number-button--active' : ''}`}\n                            onClick={() => handleSelect(num)}\n                            aria-label={`Rate ${num}`}\n                        >\n                            {num}\n                        </button>\n                    )\n                })}\n            </div>\n            {(survey.lowerBoundLabel || survey.upperBoundLabel) && (\n                <div class=\"ph-tour-survey-rating-labels\">\n                    <span>{survey.lowerBoundLabel}</span>\n                    <span>{survey.upperBoundLabel}</span>\n                </div>\n            )}\n        </div>\n    )\n}\n\nexport function ProductTourSurveyStep({\n    tour,\n    step,\n    stepIndex,\n    totalSteps,\n    onSubmit,\n    onPrevious,\n    onDismiss,\n}: ProductTourSurveyStepProps): h.JSX.Element {\n    const [textValue, setTextValue] = useState('')\n    const appearance = mergeAppearance(tour.appearance)\n    const survey = step.survey\n    const isFirstStep = stepIndex === 0\n    const isOpenText = survey?.type === 'open'\n\n    const handleTextSubmit = () => {\n        onSubmit(textValue.trim() || null)\n    }\n\n    if (!survey) {\n        return <div />\n    }\n\n    const handleOverlayClick = (e: MouseEvent) => {\n        e.stopPropagation()\n        onDismiss('user_clicked_outside')\n    }\n\n    const handleCardClick = (e: MouseEvent) => {\n        e.stopPropagation()\n    }\n\n    const containerStyle = {\n        '--ph-tour-background-color': appearance.backgroundColor,\n        '--ph-tour-text-color': appearance.textColor,\n        '--ph-tour-button-color': appearance.buttonColor,\n        '--ph-tour-button-text-color': appearance.buttonTextColor,\n        '--ph-tour-border-radius': `${appearance.borderRadius}px`,\n        '--ph-tour-border-color': appearance.borderColor,\n    } as h.JSX.CSSProperties\n\n    return (\n        <div class=\"ph-tour-container\" style={containerStyle}>\n            <div class=\"ph-tour-click-overlay\" onClick={handleOverlayClick} />\n            <div class=\"ph-tour-modal-overlay\" />\n\n            <div class=\"ph-tour-tooltip ph-tour-tooltip--modal ph-tour-survey-step\" onClick={handleCardClick}>\n                <button\n                    class=\"ph-tour-dismiss\"\n                    onClick={() => onDismiss('user_clicked_skip')}\n                    aria-label=\"Close survey\"\n                >\n                    {cancelSVG}\n                </button>\n\n                <div class=\"ph-tour-survey-question\">{survey.questionText}</div>\n\n                {isOpenText ? (\n                    <OpenTextInput value={textValue} onChange={setTextValue} onSubmit={handleTextSubmit} />\n                ) : (\n                    <RatingInput survey={survey} onSubmit={onSubmit} />\n                )}\n\n                <div class=\"ph-tour-footer\">\n                    <span class=\"ph-tour-progress\">\n                        {stepIndex + 1} of {totalSteps}\n                    </span>\n\n                    <div class=\"ph-tour-buttons\">\n                        {!isFirstStep && (\n                            <button class=\"ph-tour-button ph-tour-button--secondary\" onClick={onPrevious}>\n                                Back\n                            </button>\n                        )}\n                        {isOpenText && (\n                            <button class=\"ph-tour-button ph-tour-button--primary\" onClick={handleTextSubmit}>\n                                Submit\n                            </button>\n                        )}\n                    </div>\n                </div>\n\n                {!appearance.whiteLabel && (\n                    <a\n                        href=\"https://posthog.com/product-tours\"\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        class=\"ph-tour-branding\"\n                    >\n                        Survey by {IconPosthogLogo}\n                    </a>\n                )}\n            </div>\n        </div>\n    )\n}\n"]}