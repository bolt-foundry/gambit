"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useRerenderOnChange = useRerenderOnChange;
const react_1 = require("react");
const cache_1 = require("../core/cache");
const IsographEnvironmentProvider_1 = require("./IsographEnvironmentProvider");
// TODO add unit tests for this. Add integration tests that test
// behavior when the encounteredRecords underneath a fragment change.
function useRerenderOnChange(encounteredDataAndRecords, fragmentReference, setEncounteredDataAndRecords, readerAst) {
    const environment = (0, IsographEnvironmentProvider_1.useIsographEnvironment)();
    (0, react_1.useEffect)(() => {
        return (0, cache_1.subscribe)(environment, encounteredDataAndRecords, fragmentReference, (newEncounteredDataAndRecords) => {
            setEncounteredDataAndRecords(newEncounteredDataAndRecords);
        }, readerAst);
        // Note: this is an empty array on purpose:
        // - the fragment reference is stable for the life of the component
        // - ownership of encounteredDataAndRecords is transferred into the
        //   environment
        // - though maybe we need to include setEncounteredDataAndRecords in
        //   the dependency array
    }, []);
}
