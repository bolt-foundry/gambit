"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.NOT_SET = void 0;
exports.wrapPromise = wrapPromise;
exports.wrapResolvedValue = wrapResolvedValue;
exports.readPromise = readPromise;
exports.getPromiseState = getPromiseState;
exports.NOT_SET = Symbol('NOT_SET');
function wrapPromise(promise) {
    // TODO confirm suspense works if the promise is already resolved.
    const wrapper = { promise, result: exports.NOT_SET };
    promise
        .then((v) => {
        wrapper.result = { kind: 'Ok', value: v };
    })
        .catch((e) => {
        wrapper.result = { kind: 'Err', error: e };
    });
    return wrapper;
}
function wrapResolvedValue(value) {
    return {
        promise: Promise.resolve(value),
        result: {
            kind: 'Ok',
            value,
        },
    };
}
function readPromise(p) {
    const { result } = p;
    if (result !== exports.NOT_SET) {
        const resultKind = result;
        if (resultKind.kind === 'Ok') {
            return resultKind.value;
        }
        else {
            throw resultKind.error;
        }
    }
    throw p.promise;
}
function getPromiseState(p) {
    if (p.result !== exports.NOT_SET) {
        return p.result;
    }
    return {
        kind: 'Pending',
        promise: p.promise,
    };
}
